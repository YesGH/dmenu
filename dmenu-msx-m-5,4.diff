--- dmenu_0.c	2025-08-10 17:44:00.321999200 +0800
+++ dmenu.c	2026-02-19 17:45:03.351803185 +0800
@@ -49,6 +49,7 @@
 static struct item *matches, *matchend;
 static struct item *prev, *curr, *next, *sel;
 static int mon = -1, screen;
+static int use_cursor_pos = 0;  // 是否使用光标位置作为菜单原点
 
 static Atom clip, utf8;
 static Display *dpy;
@@ -63,6 +64,20 @@
 static int (*fstrncmp)(const char *, const char *, size_t) = strncmp;
 static char *(*fstrstr)(const char *, const char *) = strstr;
 
+// 新增：13lines获取光标位置
+static void
+get_cursor_position(int *x, int *y)
+{
+    Window root_return, child_return;
+    int win_x, win_y;
+    unsigned int mask;
+
+    if (!XQueryPointer(dpy, root, &root_return, &child_return,
+                       x, y, &win_x, &win_y, &mask)) {
+        die("failed to get cursor position");
+    }
+}
+
 static unsigned int
 textw_clamp(const char *str, unsigned int n)
 {
@@ -823,8 +838,15 @@
 				if (INTERSECT(x, y, 1, 1, info[i]) != 0)
 					break;
 
-		x = info[i].x_org + dmx;
-		y = info[i].y_org + (topbar ? dmy : info[i].height - mh - dmy);
+		// 修改：6l 启用光标位置时覆盖坐标
+		if (use_cursor_pos) {
+			get_cursor_position(&x, &y);
+			x += dmx;
+			y += (topbar ? dmy : info[i].height - mh - dmy);
+		} else {
+ 			x = info[i].x_org + dmx;
+			y = info[i].y_org + (topbar ? dmy : info[i].height - mh - dmy);
+		}
 		mw = (dmw>0 ? dmw : info[i].width);;
 		XFree(info);
 	} else
@@ -833,8 +855,15 @@
 		if (!XGetWindowAttributes(dpy, parentwin, &wa))
 			die("could not get embedding window attributes: 0x%lx",
 			    parentwin);
-		x = dmx;
-		y = topbar ? dmy : wa.height - mh - dmy;
+		// 修改6l：启用光标位置时覆盖坐标
+		if (use_cursor_pos) {
+			get_cursor_position(&x, &y);
+			x += dmx;
+			y += (topbar ? dmy : wa.height - mh - dmy);
+		} else {
+			x = dmx;
+			y = topbar ? dmy : wa.height - mh - dmy;
+		}
 		mw = (dmw>0 ? dmw : wa.width);
 	}
 	promptw = (prompt && *prompt) ? TEXTW(prompt) - lrpad / 4 : 0;
@@ -877,10 +906,12 @@
 static void
 usage(void)
 {
-	die("usage: dmenu [-bfiv] [-l lines] [-p prompt] [-fn font] [-m monitor]\n"
-	      "             [-x xoffset] [-y yoffset] [-z width]\n"
-	    "             [-nb color] [-nf color] [-sb color] [-sf color] [-w windowid]\n"
-	    "             [-d separator] [-D separator]");
+    die("usage: dmenu [-bfiv] [-l lines] [-p prompt] [-fn font] [-M monitor]\n"
+          "             [-m] [-x xoffset] [-y yoffset] [-z width]\n"
+          "             [-nb color] [-nf color] [-sb color] [-sf color] [-w windowid]\n"
+          "             [-d separator] [-D separator]\n"
+          "       -m: use cursor position as menu origin (x/y offset by -x/-y)\n"
+          "       -M: specify monitor number (original -m behavior)");
 }
 
 int
@@ -912,8 +943,10 @@
 			dmy = atoi(argv[++i]);
 		else if (!strcmp(argv[i], "-z"))   /* make dmenu this wide */
 			dmw = atoi(argv[++i]);
-		else if (!strcmp(argv[i], "-m"))
-			mon = atoi(argv[++i]);
+                else if (!strcmp(argv[i], "-m"))   // 新：启用光标位置作为菜单原点
+                        use_cursor_pos = 1;
+                else if (!strcmp(argv[i], "-M"))   // 原 -m 功能（指定显示器），改为 -M
+                        mon = atoi(argv[++i]);
 		else if (!strcmp(argv[i], "-p"))   /* adds prompt to left of input field */
 			prompt = argv[++i];
 		else if (!strcmp(argv[i], "-fn"))  /* font or font set */
